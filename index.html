<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physiatić | Advanced Physics</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- 1. Variables --- */
        :root { 
            --primary: #2d3436; --accent: #2980b9; --bg-body: #ffffff; --bg-card: #ffffff;
            --text-main: #2d3436; --text-sec: #636e72; --nav-bg: rgba(255, 255, 255, 0.95);
            --img-fit: cover; --radius: 16px; --glow: 0 0 10px rgba(41, 128, 185, 0.3);
        }
        body.dark-mode {
            --primary: #dfe6e9; --bg-body: #1e272e; --bg-card: #2d3436; --text-main: #f1f2f6;
            --text-sec: #b2bec3; --nav-bg: rgba(30, 39, 46, 0.95); --glow: 0 0 15px rgba(255, 255, 255, 0.2);
        }
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; transition: background 0.3s, color 0.3s; }
        body { margin: 0; font-family: 'Poppins', sans-serif; background: var(--bg-body); color: var(--text-main); overflow-x: hidden; }

        /* --- 2. INTRO / OUTRO ANIMATION --- */
        #intro-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100vh;
            background: #000; z-index: 99999; display: flex; justify-content: center; align-items: center;
            overflow: hidden; pointer-events: none; opacity: 0; /* Hidden by default */
        }
        /* Active State for Animation */
        #intro-overlay.active { opacity: 1; pointer-events: auto; }

        .bolt { position: absolute; top: 50%; width: 50%; height: 10px; transform: translateY(-50%); z-index: 2; }
        .bolt-left { left: -50%; background: linear-gradient(90deg, transparent, #00f2ff); box-shadow: 0 0 20px #00f2ff; clip-path: polygon(0 40%, 100% 40%, 100% 60%, 0 60%); }
        .bolt-right { right: -50%; background: linear-gradient(-90deg, transparent, #ff0055); box-shadow: 0 0 20px #ff0055; clip-path: polygon(0 40%, 100% 40%, 100% 60%, 0 60%); }
        
        .active .bolt-left { animation: strikeLeft 1s cubic-bezier(0.7, 0, 0.3, 1) forwards; }
        .active .bolt-right { animation: strikeRight 1s cubic-bezier(0.7, 0, 0.3, 1) forwards; }

        .collision-flash { position: absolute; width: 20px; height: 20px; background: white; border-radius: 50%; opacity: 0; box-shadow: 0 0 50px 20px white, 0 0 100px 50px #00f2ff, 0 0 100px 50px #ff0055; }
        .active .collision-flash { animation: explode 0.5s ease-out 0.9s forwards; }

        .intro-text { font-size: 3rem; font-weight: 900; color: white; text-transform: uppercase; letter-spacing: 2px; opacity: 0; z-index: 5; text-shadow: 0 0 10px white, 0 0 20px var(--accent); text-align: center; }
        .intro-text span { color: #00f2ff; display: block; font-size: 1.5rem; margin-top: 10px;}
        .active .intro-text { animation: textGlitch 2.5s ease-out 1s forwards; }

        @keyframes strikeLeft { 0% { left: -60%; } 100% { left: 0%; } }
        @keyframes strikeRight { 0% { right: -60%; } 100% { right: 0%; } }
        @keyframes explode { 0% { transform: scale(0); opacity: 1; } 50% { transform: scale(20); opacity: 0.8; } 100% { transform: scale(50); opacity: 0; } }
        @keyframes textGlitch { 0% { opacity: 0; transform: scale(0.8); } 10% { opacity: 1; transform: scale(1.1); } 20% { transform: skew(10deg); } 40% { transform: skew(0); } 100% { opacity: 1; transform: scale(1); } }

        /* --- 3. UI Components --- */
        .physics-toggle { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid var(--accent); color: var(--accent); font-size: 1.2rem; box-shadow: var(--glow); transition: all 0.4s; background: transparent; }
        .physics-toggle:hover { transform: rotate(180deg) scale(1.1); background: var(--accent); color: white; }

        nav { display: flex; justify-content: space-between; align-items: center; padding: 15px 8%; background: var(--nav-bg); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--text-main); cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .nav-center { display: flex; gap: 5px; }
        .nav-link { text-decoration: none; color: var(--text-sec); font-weight: 500; padding: 8px 16px; border-radius: 20px; font-size: 0.95rem; cursor: pointer; }
        .nav-link:hover, .nav-link.active-page { background: var(--accent); color: white; }
        .nav-actions { display: flex; align-items: center; gap: 15px; }
        
        .login-btn { border: 2px solid var(--accent); color: var(--accent); padding: 6px 20px; border-radius: 50px; font-weight: 600; cursor: pointer; background: transparent; }
        .login-btn:hover { background: var(--accent); color: white; }

        /* Profile Image in Nav */
        .nav-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid var(--accent); cursor: pointer; transition: 0.3s; }
        .nav-avatar:hover { transform: scale(1.1); box-shadow: 0 0 10px var(--accent); }

        /* --- Layout --- */
        .hero { display: flex; align-items: center; justify-content: space-between; padding: 50px 8%; min-height: 85vh; gap: 40px; }
        .hero-text h1 { font-size: 3.5rem; line-height: 1.2; margin-bottom: 20px; color: var(--text-main); }
        .hero-img img { width: 100%; max-width: 650px; object-fit: var(--img-fit); border-radius: var(--radius); filter: drop-shadow(0 20px 40px rgba(0,0,0,0.1)); }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; }
        .card { background: var(--bg-card); border-radius: var(--radius); overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.05); transition: 0.4s; }
        .card:hover { transform: translateY(-10px); }
        .card img { width: 100%; height: 200px; object-fit: var(--img-fit); background: #f1f2f6; }
        .card-body { padding: 25px; }
        footer { background: #1e272e; color: white; padding: 40px 8%; text-align: center; margin-top: 50px; }

        /* --- Admin Panel --- */
        #admin-panel { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 5000; display: none; justify-content: center; align-items: center; padding: 20px; }
        .dash-board { background: var(--bg-card); width: 100%; max-width: 1000px; height: 85vh; border-radius: 20px; display: flex; overflow: hidden; color: var(--text-main); }
        .sidebar { width: 250px; background: #2d3436; color: white; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .sb-btn { padding: 12px; cursor: pointer; border-radius: 8px; display: flex; align-items: center; gap: 10px; opacity: 0.7; }
        .sb-btn:hover, .sb-btn.active { background: var(--accent); opacity: 1; }
        .dash-main { flex: 1; padding: 30px; overflow-y: auto; background: var(--bg-body); }
        .dash-section { display: none; animation: fadeUp 0.3s; }
        .dash-section.active-sec { display: block; }
        
        .setting-row { margin-bottom: 20px; background: rgba(128,128,128,0.05); padding: 15px; border-radius: 10px; }
        .setting-row input, .setting-row select { padding: 10px; border-radius: 5px; border: 1px solid #ccc; width: 100%; margin-top: 5px; }

        /* Team Table Styling */
        .team-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .team-table th { text-align: left; padding: 10px; border-bottom: 2px solid var(--accent); }
        .team-table td { padding: 10px; border-bottom: 1px solid #eee; vertical-align: middle; }
        .admin-pic-small { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; border: 1px solid #ddd; }
        
        /* Password Eye */
        .pass-container { position: relative; width: 100%; }
        .pass-eye { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #888; }

        .editable { border: 2px dashed #ff7675; cursor: text; }
        #saveBtn { position: fixed; bottom: 20px; right: 20px; background: #00b894; color: white; padding: 15px 30px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; display: none; z-index: 6000; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        @media (max-width: 768px) {
            nav { flex-wrap: wrap; padding: 15px 5%; }
            .nav-center { order: 3; width: 100%; overflow-x: auto; padding: 10px 0; }
            .nav-actions { margin-left: auto; }
            .hero { flex-direction: column; text-align: center; }
            .hero-img { width: 100%; order: 2; }
            .hero-text { order: 1; }
            .dash-board { flex-direction: column; height: 95vh; }
            .sidebar { width: 100%; height: auto; flex-direction: row; overflow-x: auto; }
        }
    </style>
</head>
<body>

    <div id="intro-overlay">
        <div class="bolt bolt-left"></div>
        <div class="bolt bolt-right"></div>
        <div class="collision-flash"></div>
        <div class="intro-text" id="introMsg">
            Welcome <br> <span>Engineer</span>
        </div>
    </div>

    <nav>
        <div class="logo" onclick="route('home')">
            <i class="fas fa-atom"></i> <span data-db="site_name">Physiatić</span>
        </div>
        
        <div class="nav-center">
            <a onclick="route('home')" class="nav-link active-page" data-db="nav_1">Home</a>
            <a onclick="route('topics')" class="nav-link" data-db="nav_2">Topics</a>
            <a onclick="route('resources')" class="nav-link" data-db="nav_3">Resources</a>
            <a onclick="route('about')" class="nav-link" data-db="nav_4">About</a>
        </div>

        <div class="nav-actions">
            <button class="physics-toggle" onclick="toggleTheme()" id="themeBtn" title="Toggle Mode">
                <i id="themeIcon" class="fas fa-lightbulb"></i>
            </button>
            
            <div id="loggedOutUI">
                <button class="login-btn" onclick="openLogin()">Login</button>
            </div>
            <div id="loggedInUI" class="user-badge" style="display:none;">
                <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" id="myNavAvatar" class="nav-avatar" onclick="openDashboard()" title="Dashboard">
            </div>
        </div>
    </nav>

    <div id="main-container">
        <div id="home" class="page-sec">
            <header class="hero">
                <div class="hero-text">
                    <h1 data-db="hero_title">Discover the <br><strong>Future of Physics</strong></h1>
                    <p data-db="hero_desc" style="color:var(--text-sec); font-size:1.1rem; margin-bottom:30px;">
                        The ultimate platform for engineering students and researchers.
                    </p>
                    <button class="login-btn" style="background:var(--accent); color:white; padding:12px 30px;">Start Now</button>
                </div>
                <div class="hero-img">
                    <img id="heroImg" data-img="hero_img" src="hero-main.jpg" onerror="this.src='https://img.freepik.com/free-vector/science-lab-concept-illustration_114360-1090.jpg'">
                </div>
            </header>

            <section class="content-wrapper">
                <div style="text-align:center; margin-bottom:50px;">
                    <h2 data-db="proj_head" style="font-size:2rem;">Our Projects</h2>
                </div>
                <div class="grid">
                    <div class="card">
                        <img data-img="p1_img" src="https://m.media-amazon.com/images/I/71J1k7-w-LL.jpg">
                        <div class="card-body">
                            <h3 data-db="p1_t">Line Follower</h3>
                            <p data-db="p1_d">An autonomous robot that follows a black line using IR sensors.</p>
                        </div>
                    </div>
                    <div class="card">
                        <img data-img="p2_img" src="https://img.freepik.com/free-photo/electrical-components-circuit-board_23-2148290352.jpg">
                        <div class="card-body">
                            <h3 data-db="p2_t">Smart Circuit</h3>
                            <p data-db="p2_d">IoT based home automation system controlled via mobile app.</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        
        <div id="other-pages" class="page-sec" style="display:none; text-align:center; padding:100px 20px;">
            <i class="fas fa-flask" style="font-size:4rem; color:var(--text-sec); margin-bottom:20px;"></i>
            <h2 data-db="soon_txt">Content Coming Soon</h2>
            <p>We are currently updating this section.</p>
        </div>
    </div>

    <footer>
        <div style="display:flex; flex-direction:column; align-items:center; gap:15px;">
            <h3 data-db="foot_title">Physiatić Hub</h3>
            <p data-db="foot_sub">Empowering engineers since 2025</p>
            <div style="display:flex; gap:20px; font-size:1.5rem;">
                <i class="fab fa-facebook" style="cursor:pointer;"></i>
                <i class="fab fa-linkedin" style="cursor:pointer;"></i>
                <i class="fab fa-github" style="cursor:pointer;"></i>
            </div>
            <div style="border-top:1px solid #444; width:100%; padding-top:10px; opacity:0.7; font-size:0.9rem;">
                Developed by <span data-db="dev_name" style="color:var(--accent); font-weight:bold;">Eng. Adham Sayed</span>
            </div>
        </div>
    </footer>

    <div id="login-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:2000; justify-content:center; align-items:center;">
        <div style="background:var(--bg-card); padding:40px; border-radius:16px; width:350px; text-align:center;">
            <i class="fas fa-times" onclick="document.getElementById('login-modal').style.display='none'" style="float:right; cursor:pointer;"></i>
            <h2 style="margin-bottom:20px;">Admin Access</h2>
            
            <input type="text" id="u" placeholder="Username" style="width:100%; padding:10px; margin:10px 0; border:1px solid #ddd; border-radius:5px;">
            
            <div class="pass-container">
                <input type="password" id="p" placeholder="Password" style="width:100%; padding:10px; margin:10px 0; border:1px solid #ddd; border-radius:5px;">
                <i class="fas fa-eye pass-eye" onclick="togglePass()"></i>
            </div>
            
            <button onclick="login()" style="width:100%; padding:10px; background:var(--accent); color:white; border:none; border-radius:5px; cursor:pointer;">Login</button>
        </div>
    </div>

    <div id="admin-panel">
        <div class="dash-board">
            <div class="sidebar">
                <h3>Admin Panel</h3>
                <div class="sb-btn active" onclick="switchTab('content')"><i class="fas fa-edit"></i> Edit Content</div>
                <div class="sb-btn" onclick="switchTab('profile')"><i class="fas fa-user-circle"></i> My Profile</div>
                <div class="sb-btn" onclick="switchTab('theme')"><i class="fas fa-palette"></i> Theme</div>
                <div class="sb-btn" id="superTab" style="display:none;" onclick="switchTab('team')"><i class="fas fa-users"></i> Team</div>
                
                <div class="sb-btn" onclick="performLogout()" style="margin-top:auto; background:#c0392b; color:white;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </div>
            </div>
            
            <div class="dash-main">
                <div id="tab-content" class="dash-section active-sec">
                    <h2>Edit Website</h2>
                    <p>Change text, images, and links live.</p>
                    <button onclick="enableEdit()" style="padding:10px 20px; background:#27ae60; color:white; border:none; border-radius:5px; cursor:pointer;">
                        <i class="fas fa-pen"></i> Enable Live Edit
                    </button>
                    <p style="margin-top:20px; color:#666; font-size:0.9rem;">* Note: Footer is protected for Super Admins only.</p>
                </div>

                <div id="tab-profile" class="dash-section">
                    <h2>My Profile</h2>
                    <div class="setting-row">
                        <label>Profile Picture URL</label>
                        <input type="text" id="myProfilePicInput" placeholder="https://..." onchange="document.getElementById('previewPic').src = this.value">
                        <img id="previewPic" src="" style="width:60px; height:60px; border-radius:50%; margin-top:10px; object-fit:cover;">
                    </div>
                    <button onclick="updateProfile()" style="padding:10px; background:var(--accent); color:white; border:none; border-radius:5px; cursor:pointer;">Update Profile</button>
                </div>

                <div id="tab-theme" class="dash-section">
                    <h2>Design</h2>
                    <div class="setting-row">
                        <label>Main Color</label> <input type="color" id="accentColorPicker" value="#2980b9">
                    </div>
                    <div class="setting-row">
                        <label>Image Fit</label>
                        <select id="imgFitSelect"><option value="cover">Cover</option><option value="contain">Contain</option></select>
                    </div>
                    <button onclick="saveThemeSettings()" style="width:100%; padding:15px; background:var(--primary); color:white; border:none; border-radius:8px; cursor:pointer;">Save Theme</button>
                </div>

                <div id="tab-team" class="dash-section">
                    <h2>Team Manager</h2>
                    <div class="setting-row">
                        <input id="newAdmin" placeholder="New Username" style="width:30%;">
                        <input id="newPass" placeholder="Password" style="width:30%;">
                        <button onclick="addAdmin()" style="width:30%; background:var(--accent); color:white; border:none; padding:10px;">Add Admin</button>
                    </div>
                    
                    <h3>Current Admins</h3>
                    <table class="team-table">
                        <thead><tr><th>Img</th><th>Name</th><th>Pass</th><th>Role</th></tr></thead>
                        <tbody id="teamList"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <button id="saveBtn" onclick="saveData()">Save Content Changes</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyAXV0GFrmWdO26Zz8cP5Ko_Kn-9wedeT9o",
          authDomain: "physiatic-508a1.firebaseapp.com",
          projectId: "physiatic-508a1",
          storageBucket: "physiatic-508a1.firebasestorage.app",
          messagingSenderId: "729031647428",
          appId: "1:729031647428:web:11bbf71bff5daedc1aa991"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        let currentUser = JSON.parse(localStorage.getItem('user'));

        // --- 1. CONFIG & ANIMATION ---
        async function loadConfig() {
            // Check for intro trigger
            if(!sessionStorage.getItem('introPlayed')) {
                playAnimation('Welcome', 'Engineer');
                sessionStorage.setItem('introPlayed', 'true');
            }

            const docSnap = await getDoc(doc(db, "settings", "config"));
            if(docSnap.exists()) {
                const data = docSnap.data();
                if(data.accent) document.documentElement.style.setProperty('--accent', data.accent);
                if(data.imgFit) document.documentElement.style.setProperty('--img-fit', data.imgFit);
                
                document.getElementById('accentColorPicker').value = data.accent || '#2980b9';
                document.getElementById('imgFitSelect').value = data.imgFit || 'cover';
            }
        }
        loadConfig();

        // --- 2. AUTH ---
        window.login = async function() {
            const u = document.getElementById('u').value.trim();
            const p = document.getElementById('p').value.trim();
            const docRef = doc(db, "settings", "admins");
            
            const snap = await getDoc(docRef);
            if(!snap.exists()) await setDoc(docRef, { list: [{u:'Adham', p:'20250003', role:'super_admin', img:''}] });

            const list = (await getDoc(docRef)).data().list;
            const found = list.find(a => a.u === u && a.p === p);

            if(found) {
                localStorage.setItem('user', JSON.stringify(found));
                location.reload();
            } else { alert("Wrong Credentials!"); }
        }

        window.performLogout = function() {
            document.getElementById('admin-panel').style.display = 'none';
            // Goodbye Animation
            playAnimation('Goodbye', 'Engineer, Enjoy your day');
            setTimeout(() => {
                localStorage.removeItem('user');
                sessionStorage.removeItem('introPlayed');
                location.reload();
            }, 3500); // Wait for animation
        }

        window.togglePass = function() {
            const inp = document.getElementById('p');
            inp.type = inp.type === 'password' ? 'text' : 'password';
        }

        // --- 3. TEAM & PROFILE ---
        window.addAdmin = async function() {
            const u = document.getElementById('newAdmin').value;
            const p = document.getElementById('newPass').value;
            // Default placeholder image
            await updateDoc(doc(db, "settings", "admins"), { 
                list: arrayUnion({u, p, role:'admin', img:'https://cdn-icons-png.flaticon.com/512/3135/3135715.png'}) 
            });
            alert("Added!"); loadTeamList();
        }

        window.updateProfile = async function() {
            const newImg = document.getElementById('myProfilePicInput').value;
            if(!newImg) return;

            const docRef = doc(db, "settings", "admins");
            const snap = await getDoc(docRef);
            let list = snap.data().list;
            
            // Find me and update
            const idx = list.findIndex(a => a.u === currentUser.u);
            if(idx !== -1) {
                list[idx].img = newImg;
                await setDoc(docRef, { list: list }); // Save entire list
                
                // Update Local & UI
                currentUser.img = newImg;
                localStorage.setItem('user', JSON.stringify(currentUser));
                document.getElementById('myNavAvatar').src = newImg;
                alert("Profile Updated!");
            }
        }

        async function loadTeamList() {
            const snap = await getDoc(doc(db, "settings", "admins"));
            const list = snap.data().list || [];
            document.getElementById('teamList').innerHTML = list.map(a => `
                <tr>
                    <td><img src="${a.img || 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png'}" class="admin-pic-small"></td>
                    <td><b>${a.u}</b></td>
                    <td style="font-family:monospace; color:#e74c3c;">${a.p}</td>
                    <td>${a.role}</td>
                </tr>
            `).join('');
        }

        // --- 4. DATA SAVING & PROTECTION ---
        window.enableEdit = function() {
            document.getElementById('admin-panel').style.display='none';
            document.body.classList.add('editing');
            document.getElementById('saveBtn').style.display='block';
            
            document.querySelectorAll('[data-db]').forEach(el => { 
                // PROTECTION LOGIC: If not super admin, don't allow editing footer
                if(currentUser.role !== 'super_admin') {
                    if(el.closest('footer')) return; // Skip footer elements
                    if(el.getAttribute('data-db').includes('dev')) return; // Skip dev name
                }
                el.contentEditable="true"; el.classList.add('editable'); 
            });
            
            document.querySelectorAll('[data-img]').forEach(el => { 
                el.classList.add('editable-img'); 
                el.onclick = (e) => { e.preventDefault(); let u = prompt("Image URL:", el.src); if(u) el.src = u; };
            });
        }

        window.saveData = async function() {
            let payload = {};
            document.querySelectorAll('[data-db]').forEach(el => payload[el.getAttribute('data-db')] = el.innerHTML);
            document.querySelectorAll('[data-img]').forEach(el => payload[el.getAttribute('data-img')] = el.src);
            await setDoc(doc(db, "site_data", "content"), payload, {merge:true});
            alert("Content Saved!"); location.reload();
        }

        window.saveThemeSettings = async function() {
            const color = document.getElementById('accentColorPicker').value;
            const fit = document.getElementById('imgFitSelect').value;
            await setDoc(doc(db, "settings", "config"), { accent: color, imgFit: fit }, {merge: true});
            alert("Theme Saved!"); location.reload();
        }

        // --- 5. REALTIME ---
        onSnapshot(doc(db, "site_data", "content"), (doc) => {
            if(doc.exists() && !document.body.classList.contains('editing')) {
                const data = doc.data();
                document.querySelectorAll('[data-db]').forEach(el => { if(data[el.getAttribute('data-db')]) el.innerHTML = data[el.getAttribute('data-db')]; });
                document.querySelectorAll('[data-img]').forEach(el => { if(data[el.getAttribute('data-img')]) el.src = data[el.getAttribute('data-img')]; });
            }
        });

        // INIT UI
        if(currentUser) {
            document.getElementById('loggedOutUI').style.display='none';
            document.getElementById('loggedInUI').style.display='flex';
            if(currentUser.img) document.getElementById('myNavAvatar').src = currentUser.img;
            
            if(currentUser.role === 'super_admin') { 
                document.getElementById('superTab').style.display='flex'; 
                loadTeamList(); 
            }
        }

        // --- Helper: Animation Trigger ---
        function playAnimation(line1, line2) {
            const overlay = document.getElementById('intro-overlay');
            const txt = document.getElementById('introMsg');
            txt.innerHTML = `${line1} <br> <span>${line2}</span>`;
            
            overlay.classList.remove('active');
            void overlay.offsetWidth; // trigger reflow
            overlay.classList.add('active');
            
            // Remove after 3.5s
            setTimeout(() => {
                overlay.classList.remove('active');
            }, 3500);
        }

    </script>

    <script>
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }
        if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');

        function route(p) {
            document.querySelectorAll('.page-sec').forEach(s => s.style.display='none');
            if(p === 'home') document.getElementById('home').style.display='block';
            else document.getElementById('other-pages').style.display='block';
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active-page'));
            event.target.classList.add('active-page');
        }

        function openLogin() { document.getElementById('login-modal').style.display='flex'; }
        function openDashboard() { document.getElementById('admin-panel').style.display='flex'; }
        function switchTab(t) {
            document.querySelectorAll('.dash-section').forEach(s => s.classList.remove('active-sec'));
            document.getElementById('tab-'+t).classList.add('active-sec');
        }
    </script>
</body>
                            </html>
