<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhysiatiÄ‡ | Advanced Physics</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- 1. General & Variables --- */
        :root { 
            --primary: #2d3436;      
            --accent: #2980b9;       
            --bg-light: #ffffff; 
            --bg-soft: #f9fbfd;
            --nav-hover: #eaf2f8;
            --glass: rgba(255, 255, 255, 0.98);
        }
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { 
            margin: 0; font-family: 'Poppins', sans-serif; 
            background: var(--bg-light); color: var(--primary); 
            overflow-x: hidden; 
        }

        /* --- Animations --- */
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-up { animation: fadeUp 0.8s ease-out forwards; opacity: 0; }
        .delay-1 { animation-delay: 0.2s; }
        .delay-2 { animation-delay: 0.4s; }

        /* --- 2. Navigation (Responsive) --- */
        nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 8%; background: var(--glass); backdrop-filter: blur(10px);
            position: sticky; top: 0; z-index: 1000;
            box-shadow: 0 2px 15px rgba(0,0,0,0.03);
            flex-wrap: wrap; /* Important for mobile */
        }
        .logo { font-size: 1.5rem; font-weight: 800; color: #2c3e50; cursor: pointer; display: flex; align-items: center; gap: 5px; }
        
        .nav-links { display: flex; gap: 10px; align-items: center; }
        .nav-link {
            text-decoration: none; color: #636e72; font-weight: 500;
            padding: 8px 16px; border-radius: 20px; transition: 0.3s; cursor: pointer; white-space: nowrap;
        }
        .nav-link:hover, .nav-link.active-page { background: var(--nav-hover); color: var(--accent); }

        /* User Controls */
        .login-btn { border: 2px solid var(--accent); color: var(--accent); padding: 5px 20px; border-radius: 50px; font-weight: 600; cursor: pointer; transition: 0.3s; font-size: 0.9rem; }
        .login-btn:hover { background: var(--accent); color: white; }
        
        .user-badge { display: none; align-items: center; gap: 10px; }
        .admin-tag { background: #e74c3c; color: white; font-size: 0.6rem; padding: 2px 6px; border-radius: 4px; vertical-align: middle; }

        /* --- 3. Hero Section (Responsive) --- */
        .hero { 
            display: flex; align-items: center; justify-content: space-between; 
            padding: 40px 8%; min-height: 85vh; gap: 30px;
        }
        .hero-text { flex: 1; }
        .hero-text h1 { font-size: 3.5rem; line-height: 1.2; margin-bottom: 20px; color: #1e272e; }
        .hero-img { flex: 1; display: flex; justify-content: center; }
        .hero-img img { width: 100%; max-width: 600px; height: auto; transition: 0.3s; cursor: default; border-radius: 10px; }
        .hero-img img:hover { transform: scale(1.02); }

        /* --- 4. Projects Grid --- */
        .projects-wrapper { padding: 60px 8%; background: var(--bg-soft); }
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 30px; 
        }
        .card { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.04); transition: 0.4s; }
        .card:hover { transform: translateY(-10px); }
        .card img { width: 100%; height: 180px; object-fit: cover; }
        .card-body { padding: 25px; }
        .card h3 { color: var(--accent); margin: 0 0 10px; font-size: 1.2rem; }

        /* --- 5. Login Modal (Responsive) --- */
        #login-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2000;
            display: none; justify-content: center; align-items: center;
            backdrop-filter: blur(5px); padding: 20px;
        }
        .modal-box {
            background: white; padding: 40px; border-radius: 20px; width: 100%; max-width: 400px;
            text-align: center; position: relative; animation: fadeUp 0.3s; box-shadow: 0 20px 50px rgba(0,0,0,0.2);
        }
        .modal-box input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
        .pass-wrapper { position: relative; }
        .toggle-pass { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #888; }
        .close-modal { position: absolute; top: 15px; right: 15px; cursor: pointer; font-size: 1.5rem; color: #333; }

        /* --- 6. Admin Dashboard (Fully Responsive) --- */
        #admin-panel {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 3000;
            display: none; justify-content: center; align-items: center; padding: 20px;
        }
        .dash-board {
            background: white; width: 100%; max-width: 1000px; height: 80vh;
            border-radius: 20px; display: flex; overflow: hidden; position: relative;
        }
        .sidebar { width: 250px; background: #2c3e50; color: white; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .sb-btn { padding: 15px; cursor: pointer; border-radius: 8px; transition: 0.3s; display: flex; align-items: center; gap: 10px; }
        .sb-btn:hover, .sb-btn.active { background: var(--accent); }
        
        .dash-main { flex: 1; padding: 30px; background: #f4f6f8; overflow-y: auto; }
        .dash-section { display: none; }
        .dash-section.active-sec { display: block; animation: fadeUp 0.3s; }
        
        /* Edit Mode Styles */
        .editable { border: 2px dashed #e74c3c; background: rgba(231, 76, 60, 0.05); cursor: text; }
        .editable-img { border: 4px solid #e74c3c; opacity: 0.8; cursor: pointer !important; }
        
        #saveBtn {
            position: fixed; bottom: 30px; right: 30px; background: #27ae60;
            color: white; padding: 15px 35px; border-radius: 50px; border: none;
            font-weight: bold; cursor: pointer; box-shadow: 0 10px 20px rgba(39, 174, 96, 0.3);
            display: none; z-index: 4000;
        }

        /* --- 7. MEDIA QUERIES (THE MAGIC) --- */
        @media (max-width: 992px) {
            .hero h1 { font-size: 2.8rem; }
            .hero-img img { max-width: 100%; }
        }

        @media (max-width: 768px) {
            /* Nav */
            nav { padding: 15px 5%; flex-direction: column; align-items: flex-start; gap: 15px; }
            .logo { width: 100%; justify-content: space-between; }
            /* Add user badge to top row next to logo on mobile */
            #loggedInUI, #loggedOutUI { position: absolute; top: 15px; right: 5%; }
            
            .nav-links { 
                width: 100%; overflow-x: auto; padding-bottom: 5px; 
                justify-content: flex-start; /* Left align scroll */
            }
            .nav-links::-webkit-scrollbar { height: 0px; background: transparent; } /* Hide scrollbar */

            /* Hero */
            .hero { flex-direction: column; text-align: center; padding-top: 20px; min-height: auto; padding-bottom: 60px; }
            .hero-text { padding: 0; order: 1; } /* Text first */
            .hero-img { order: 2; margin-top: 20px; }
            .hero h1 { font-size: 2.2rem; }
            
            /* Admin Panel Mobile */
            .dash-board { flex-direction: column; height: 90vh; }
            .sidebar { 
                width: 100%; height: auto; flex-direction: row; 
                overflow-x: auto; padding: 10px; align-items: center; 
                border-bottom: 1px solid #ddd;
            }
            .sb-btn { padding: 10px; font-size: 0.9rem; white-space: nowrap; }
            .dash-main { padding: 20px; }
        }

        /* Table Responsive */
        .table-responsive { overflow-x: auto; }
        .team-table { width: 100%; border-collapse: collapse; min-width: 500px; } /* Ensure min width for scroll */
        .team-table th, .team-table td { padding: 12px; font-size: 0.9rem; }
    </style>
</head>
<body>

    <nav>
        <div class="logo" onclick="route('home')"><i class="fas fa-atom"></i> PhysiatiÄ‡</div>
        
        <div class="nav-links">
            <a onclick="route('home')" class="nav-link active-page">Home</a>
            <a onclick="route('topics')" class="nav-link">Topics</a>
            <a onclick="route('resources')" class="nav-link">Resources</a>
            <a onclick="route('about')" class="nav-link">About</a>
        </div>
        
        <div id="loggedOutUI">
            <button class="login-btn" onclick="openLogin()"><i class="fas fa-sign-in-alt"></i></button>
        </div>

        <div id="loggedInUI" class="user-badge">
            <span id="userGreeting" style="font-weight:600; font-size:0.9rem;"></span>
            <button onclick="openDashboard()" style="background:var(--primary); color:white; border:none; width:30px; height:30px; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center;">
                <i class="fas fa-cog"></i>
            </button>
            <i class="fas fa-power-off" onclick="performLogout()" style="color:red; cursor:pointer; font-size:1.1rem;" title="Logout"></i>
        </div>
    </nav>

    <div id="main-container">
        <div id="home" class="page-sec">
            <header class="hero">
                <div class="hero-text animate-up">
                    <h1 data-db="hero_title">Master the Art of <br><strong>Physical Science</strong></h1>
                    <p data-db="hero_desc" style="color:#636e72; font-size:1.1rem; margin-bottom:30px;">
                        The ultimate hub for engineering projects and research.
                    </p>
                    <button class="login-btn" style="background:var(--accent); color:white; padding: 12px 30px; font-size: 1rem;">Start Exploring</button>
                </div>
                <div class="hero-img animate-up delay-1">
                    <img id="mainHeroImg" data-img="hero_img" src="hero-main.jpg" onerror="this.src='https://img.freepik.com/free-vector/science-lab-concept-illustration_114360-1090.jpg'" alt="Cover">
                </div>
            </header>

            <section class="projects-wrapper animate-up delay-2">
                <div style="text-align:center; margin-bottom:40px;">
                    <h2 data-db="proj_head">Featured Projects</h2>
                </div>
                <div class="grid">
                    <div class="card">
                        <img id="proj1Img" data-img="p1_img" src="https://m.media-amazon.com/images/I/71J1k7-w-LL.jpg" alt="Robot">
                        <div class="card-body">
                            <h3 data-db="p1_t">Line Follower Robot</h3>
                            <p data-db="p1_d">Autonomous robot tracking pathways with high precision.</p>
                        </div>
                    </div>
                    <div class="card">
                        <img id="proj2Img" data-img="p2_img" src="https://img.freepik.com/free-photo/electrical-components-circuit-board_23-2148290352.jpg" alt="Circuit">
                        <div class="card-body">
                            <h3 data-db="p2_t">Smart Circuitry</h3>
                            <p data-db="p2_d">Advanced PCB design for automation.</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <div id="other-pages" class="page-sec" style="display:none; text-align:center; padding:100px 20px;">
            <i class="fas fa-rocket" style="font-size:4rem; color:#ccc;"></i>
            <h2 style="margin-top:20px;">Coming Soon</h2>
            <p>We are building this section.</p>
        </div>
    </div>

    <div id="login-modal">
        <div class="modal-box">
            <i class="fas fa-times close-modal" onclick="closeLogin()"></i>
            <h2>Admin Access</h2>
            <input type="text" id="loginUser" placeholder="Username">
            <div class="pass-wrapper">
                <input type="password" id="loginPass" placeholder="Password">
                <i class="fas fa-eye toggle-pass" onclick="togglePass()"></i>
            </div>
            <button onclick="attemptLogin()" style="width:100%; padding:12px; background:var(--accent); color:white; border:none; border-radius:8px; margin-top:10px; cursor:pointer; font-weight:600;">Login</button>
            <p id="loginError" style="color:red; display:none; margin-top:10px; font-size:0.9rem;">Wrong Credentials!</p>
        </div>
    </div>

    <div id="admin-panel">
        <div class="dash-board">
            <div class="sidebar">
                <h3 style="margin:0; font-size:1.2rem;">Control Panel</h3>
                <div class="sb-btn active" onclick="switchTab('content')"><i class="fas fa-pen"></i> Content</div>
                <div class="sb-btn" id="superAdminTab" style="display:none;" onclick="switchTab('team')"><i class="fas fa-users"></i> Team</div>
                <div class="sb-btn" onclick="closeDashboard()" style="margin-top:auto; background:#c0392b; justify-self: flex-end;"><i class="fas fa-times"></i> Close</div>
            </div>
            
            <div class="dash-main">
                <div id="tab-content" class="dash-section active-sec">
                    <h2>Website Content</h2>
                    <div style="background:white; padding:20px; border-radius:10px; margin-top:20px;">
                        <h4><i class="fas fa-magic"></i> Live Editor</h4>
                        <p>Click the button below. You can then click on any text OR image on the website to change it.</p>
                        <button onclick="enableLiveEdit()" style="padding:10px 20px; background:#27ae60; color:white; border:none; border-radius:5px; cursor:pointer;">
                            Enable Live Edit
                        </button>
                    </div>
                </div>

                <div id="tab-team" class="dash-section">
                    <h2>Manage Admins</h2>
                    <div style="background:white; padding:20px; border-radius:10px; margin-top:20px;">
                        <h4>Add New Admin</h4>
                        <div style="display:flex; gap:10px; flex-wrap:wrap;">
                            <input type="text" id="newAdminUser" placeholder="Username" style="flex:1; padding:8px; min-width:120px;">
                            <input type="text" id="newAdminPass" placeholder="Password" style="flex:1; padding:8px; min-width:120px;">
                            <button onclick="addNewAdmin()" style="padding:8px 20px; background:var(--accent); color:white; border:none; cursor:pointer; border-radius:4px;">Add</button>
                        </div>
                    </div>
                    
                    <h4 style="margin-top:30px;">Current Team</h4>
                    <div class="table-responsive">
                        <table class="team-table">
                            <thead><tr><th>Name</th><th>Role</th><th>Action</th></tr></thead>
                            <tbody id="adminListBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button id="saveBtn" onclick="saveChanges()"><i class="fas fa-save"></i> Save</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot, arrayUnion, arrayRemove } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // âœ… FINAL FIREBASE CONFIG
        const firebaseConfig = {
          apiKey: "AIzaSyAXV0GFrmWdO26Zz8cP5Ko_Kn-9wedeT9o",
          authDomain: "physiatic-508a1.firebaseapp.com",
          projectId: "physiatic-508a1",
          storageBucket: "physiatic-508a1.firebasestorage.app",
          messagingSenderId: "729031647428",
          appId: "1:729031647428:web:11bbf71bff5daedc1aa991"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- 1. SESSION MANAGEMENT ---
        const savedUser = localStorage.getItem('physiatic_user');
        if(savedUser) {
            try {
                const user = JSON.parse(savedUser);
                setupLoggedInState(user);
            } catch(e) { localStorage.removeItem('physiatic_user'); }
        }

        // --- 2. AUTH FUNCTIONS ---
        window.attemptLogin = async function() {
            const u = document.getElementById('loginUser').value.trim();
            const p = document.getElementById('loginPass').value.trim();
            const btn = document.querySelector('#login-modal button');
            const err = document.getElementById('loginError');
            
            const originalText = btn.innerText;
            btn.innerText = "Checking...";
            btn.disabled = true;
            err.style.display = 'none';

            try {
                const docRef = doc(db, "settings", "admins");
                const docSnap = await getDoc(docRef);
                
                let adminList = [];

                if(!docSnap.exists()) {
                    console.log("Creating Super Admin...");
                    adminList = [{u: "Adham", p: "20250003", role: "super_admin"}];
                    await setDoc(docRef, { list: adminList });
                } else {
                    adminList = docSnap.data().list || [];
                }

                const found = adminList.find(a => a.u === u && a.p === p);

                if(found) {
                    localStorage.setItem('physiatic_user', JSON.stringify(found));
                    setupLoggedInState(found);
                    closeLogin();
                    alert(`Welcome Eng. ${found.u} ðŸš€`);
                } else {
                    err.innerText = "Wrong Username or Password!";
                    err.style.display = 'block';
                }

            } catch (error) {
                console.error("Login Error:", error);
                alert("Connection Error. Check your internet.");
            }

            btn.innerText = originalText;
            btn.disabled = false;
        }

        function setupLoggedInState(user) {
            document.getElementById('loggedOutUI').style.display = 'none';
            document.getElementById('loggedInUI').style.display = 'flex';
            
            // Mobile Optimization for greeting: Shorten if needed
            const displayName = user.u.length > 8 ? user.u.substring(0,6)+'..' : user.u;
            document.getElementById('userGreeting').innerHTML = 
                `Hi, ${displayName} ${user.role==='super_admin' ? '<span class="admin-tag">Super</span>' : ''}`;
            
            if(user.role === 'super_admin') {
                document.getElementById('superAdminTab').style.display = 'flex';
            }
        }

        window.performLogout = function() {
            if(confirm("Log out?")) {
                localStorage.removeItem('physiatic_user');
                location.reload();
            }
        }

        // --- 3. TEAM MANAGER ---
        window.loadTeam = async function() {
            const docRef = doc(db, "settings", "admins");
            onSnapshot(docRef, (doc) => {
                if(doc.exists()){
                    const list = doc.data().list || [];
                    const tbody = document.getElementById('adminListBody');
                    if(tbody) {
                        tbody.innerHTML = '';
                        list.forEach(a => {
                            const currentUser = JSON.parse(localStorage.getItem('physiatic_user')).u;
                            const deleteBtn = (a.u === currentUser || a.role === 'super_admin') ? 
                                `<span style="color:#ccc;">-</span>` : 
                                `<button onclick="deleteAdmin('${a.u}')" style="color:red; border:1px solid #ddd; background:#fff; padding:5px; border-radius:5px; cursor:pointer;"><i class="fas fa-trash"></i></button>`;
                            
                            tbody.innerHTML += `
                                <tr>
                                    <td>${a.u}</td>
                                    <td>${a.role === 'super_admin' ? 'Super' : 'Admin'}</td>
                                    <td>${deleteBtn}</td>
                                </tr>
                            `;
                        });
                    }
                }
            });
        }

        window.addNewAdmin = async function() {
            const u = document.getElementById('newAdminUser').value.trim();
            const p = document.getElementById('newAdminPass').value.trim();
            if(!u || !p) return alert("Fill fields!");

            try {
                await updateDoc(doc(db, "settings", "admins"), {
                    list: arrayUnion({ u: u, p: p, role: "admin" })
                });
                alert("Admin Added!");
                document.getElementById('newAdminUser').value = '';
                document.getElementById('newAdminPass').value = '';
            } catch(e) { alert(e.message); }
        }

        window.deleteAdmin = async function(username) {
            if(!confirm("Remove this admin?")) return;
            const docRef = doc(db, "settings", "admins");
            const snap = await getDoc(docRef);
            if(snap.exists()) {
                const list = snap.data().list;
                const toRemove = list.find(a => a.u === username);
                if(toRemove) await updateDoc(docRef, { list: arrayRemove(toRemove) });
            }
        }

        // --- 4. DATA SYNC ---
        const contentRef = doc(db, "site_data", "main_content");
        
        onSnapshot(contentRef, (docSnap) => {
            if (docSnap.exists() && !document.body.classList.contains('editing-mode')) {
                const data = docSnap.data();
                document.querySelectorAll('[data-db]').forEach(el => {
                    const key = el.getAttribute('data-db');
                    if(data[key]) el.innerHTML = data[key];
                });
                document.querySelectorAll('[data-img]').forEach(el => {
                    const key = el.getAttribute('data-img');
                    if(data[key]) el.src = data[key];
                });
            }
        });

        window.saveChanges = async function() {
            const btn = document.getElementById('saveBtn');
            btn.innerHTML = '...';
            
            let payload = {};
            document.querySelectorAll('[data-db]').forEach(el => {
                payload[el.getAttribute('data-db')] = el.innerHTML;
            });
            document.querySelectorAll('[data-img]').forEach(el => {
                payload[el.getAttribute('data-img')] = el.getAttribute('src');
            });

            try {
                await setDoc(contentRef, payload, {merge: true});
                alert("Saved! ðŸš€");
                disableLiveEdit();
            } catch(e) { alert("Error: " + e.message); }
            btn.innerHTML = '<i class="fas fa-save"></i> Save';
        }

        if(localStorage.getItem('physiatic_user')) {
             const u = JSON.parse(localStorage.getItem('physiatic_user'));
             if(u.role === 'super_admin') window.loadTeam();
        }
    </script>

    <script>
        function route(page) {
            document.querySelectorAll('.page-sec').forEach(d => d.style.display = 'none');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active-page'));
            
            if(page === 'home') {
                document.getElementById('home').style.display = 'block';
                document.querySelector('.nav-link').classList.add('active-page'); 
            } else {
                document.getElementById('other-pages').style.display = 'block';
            }
        }

        function openLogin() { document.getElementById('login-modal').style.display = 'flex'; }
        function closeLogin() { document.getElementById('login-modal').style.display = 'none'; }
        function togglePass() {
            const inp = document.getElementById('loginPass');
            const icon = document.querySelector('.toggle-pass');
            if(inp.type === "password") { inp.type = "text"; icon.classList.remove('fa-eye'); icon.classList.add('fa-eye-slash'); }
            else { inp.type = "password"; icon.classList.add('fa-eye'); icon.classList.remove('fa-eye-slash'); }
        }

        function openDashboard() { 
            document.getElementById('admin-panel').style.display = 'flex'; 
            const u = JSON.parse(localStorage.getItem('physiatic_user'));
            if(u && u.role === 'super_admin') window.loadTeam();
        }
        function closeDashboard() { document.getElementById('admin-panel').style.display = 'none'; }
        
        function switchTab(tab) {
            document.querySelectorAll('.dash-section').forEach(s => s.classList.remove('active-sec'));
            document.querySelectorAll('.sb-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-'+tab).classList.add('active-sec');
            event.currentTarget.classList.add('active');
        }

        function enableLiveEdit() {
            closeDashboard();
            document.body.classList.add('editing-mode');
            document.getElementById('saveBtn').style.display = 'block';
            
            document.querySelectorAll('[data-db]').forEach(el => {
                el.contentEditable = "true";
                el.classList.add('editable');
            });

            document.querySelectorAll('[data-img]').forEach(el => {
                el.classList.add('editable-img');
                el.onclick = function(e) {
                    if(!document.body.classList.contains('editing-mode')) return;
                    e.preventDefault();
                    const newUrl = prompt("Enter new Image URL:", el.src);
                    if(newUrl) el.src = newUrl;
                }
            });
            alert("Editing Mode ON");
        }

        function disableLiveEdit() {
            document.body.classList.remove('editing-mode');
            document.getElementById('saveBtn').style.display = 'none';
            document.querySelectorAll('[data-db]').forEach(el => {
                el.contentEditable = "false";
                el.classList.remove('editable');
            });
            document.querySelectorAll('[data-img]').forEach(el => {
                el.classList.remove('editable-img');
                el.onclick = null;
            });
        }
    </script>
</body>
    </html>
